# 躯干疼痛ADL残疾风险预测器

这是一个基于机器学习的Streamlit Web应用，用于预测躯干疼痛患者的ADL（日常生活活动）残疾风险。

## 功能特点

- 🎯 **智能预测**：基于SVM模型预测ADL残疾风险
- 📊 **可视化解释**：使用SHAP瀑布图解释预测结果
- 🌐 **中文界面**：完全中文化的用户界面
- 📱 **响应式设计**：支持各种设备访问
- 🔍 **特征重要性**：详细展示各变量对预测的影响

## 安装和运行

### 方法1：使用启动脚本（推荐）

```bash
# 进入streamlit目录
cd streamlit

# 运行启动脚本
python run_app.py
```

### 方法2：直接使用Streamlit命令

```bash
# 进入streamlit目录
cd streamlit

# 安装依赖
pip install -r requirements.txt

# 启动应用
streamlit run app.py
```

### 方法3：使用虚拟环境

```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境
# Windows:
.venv\Scripts\activate
# Unix/Linux/Mac:
source .venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动应用
streamlit run app.py
```

## 系统要求

- Python 3.8+
- 内存：至少2GB可用内存
- 存储：至少100MB可用空间

## 依赖包

- streamlit >= 1.36
- pandas >= 1.5
- numpy >= 1.24
- scikit-learn >= 1.2
- joblib >= 1.2
- shap >= 0.43
- matplotlib >= 3.7
- plotly >= 5.0

## 使用方法

1. **启动应用**：运行上述任一启动命令
2. **输入数据**：在表单中输入患者的17个临床变量
3. **获取预测**：点击"开始预测"按钮
4. **查看结果**：查看预测类别、风险概率和SHAP解释图
5. **理解结果**：使用说明部分帮助理解预测结果

## 输入变量说明

应用需要输入以下17个变量：

### 人口统计学
- **性别**：女性(0) / 男性(1)
- **年龄**：45-85岁
- **婚姻状况**：未婚(0) / 已婚(1)
- **教育水平**：高中以下(1) / 高中及以上(2)

### 疾病史
- **高血压**：否(0) / 是(1)
- **糖尿病**：否(0) / 是(1)
- **中风**：否(0) / 是(1)
- **情绪问题**：否(0) / 是(1)
- **记忆相关疾病**：否(0) / 是(1)
- **关节炎或风湿病**：否(0) / 是(1)
- **跌倒**：否(0) / 是(1)
- **抑郁症**：否(0) / 是(1)

### 生活方式
- **自评健康状况**：差(1) / 一般(2) / 好(3)
- **体力活动水平**：低(1) / 中(2) / 高(3)
- **住院次数**：≥0
- **网络参与**：否(0) / 使用互联网(1)
- **智力活动**：否(0) / 参与(1)

## 输出结果解释

### 预测类别
- **0**：无ADL残疾风险
- **1**：存在ADL残疾风险

### 风险概率
- 0-1之间的数值，越接近1风险越高
- 显示为百分比形式

### SHAP解释图
- 显示每个特征对预测结果的贡献
- 正值：增加风险
- 负值：降低风险
- 绝对值越大，影响越显著

## 注意事项

⚠️ **重要提醒**：
- 此工具提供数据驱动的估计，不能替代专业医疗建议
- 模型基于训练数据，实际应用需结合临床判断
- 年龄和住院次数会自动标准化处理
- 所有分类变量已编码为数值

## 故障排除

### 常见问题

1. **依赖包安装失败**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

2. **端口被占用**
   ```bash
   streamlit run app.py --server.port 8502
   ```

3. **内存不足**
   - 关闭其他应用程序
   - 减少SHAP背景样本数量（在代码中修改）

4. **文件路径错误**
   - 确保在streamlit目录下运行
   - 检查data和model文件夹是否存在

### 获取帮助

如果遇到问题，请检查：
1. Python版本是否兼容
2. 所有依赖包是否正确安装
3. 必要文件是否存在
4. 控制台错误信息

## 技术架构

- **前端**：Streamlit
- **后端**：Python + scikit-learn
- **模型**：SVM分类器
- **解释性**：SHAP (SHapley Additive exPlanations)
- **数据处理**：pandas + numpy
- **可视化**：matplotlib + plotly

## 许可证

本项目仅供学习和研究使用。
